package colletion

import com.fasterxml.jackson.annotation.JsonProperty

object flatMap {
  //flatMap은 map과 flatten을 합성한 것이다. 내포 리스트에 적용할 수 있는 함수를 중첩된 리스트 안의 각 리스트에 적용해서 나온 결과를 하나의 리스트로 합쳐준다.
  def main(args: Array[String]): Unit = {
    val l1 = List(List(1,2), List(3,4))
    val a = l1.flatMap(x => x.map(_*2))
    println(a)

    val b = l1.map((x:List[Int]) => x.map(_*2)).flatten
    println(b)

    //판교역 -> 강남구청
    val link1 = Link("127.10841061584854,37.40240759712626 127.10658067621765,37.40242081631585 127.10654658043828,37.40243858017555 127.10651259162256,37.40244733408562 127.10648957579983,37.402483203151625 127.10646581105611,37.402582141787406 127.10645821495126,37.40322184743522")
    val link2 = Link("127.10645821495126,37.40322184743522 127.10969982611792,37.4032282790005 127.10969982611792,37.4032282790005 127.1121734419999,37.403228857404855 127.1121734419999,37.403228857404855 127.1127266395656,37.40325103149278 127.1127266395656,37.40325103149278 127.11311074472232,37.403244902511176")
    val link3 = Link("127.11311074472232,37.403244902511176 127.11307314554767,37.403559996752726")
    val link4 = Link("127.11307314554767,37.403559996752726 127.1130490704601,37.4036859666622 127.1130490704601,37.4036859666622 127.11295489355706,37.40400964715867 127.1125247874476,37.405042655693144 127.11215613872913,37.405652618849544 127.11171992948559,37.40624405171446 127.11152536897703,37.40645884772786 127.11103576396903,37.40678856509587 127.11103576396903,37.40678856509587 127.11043171668352,37.407243569809474 127.11043171668352,37.407243569809474 127.10941561201501,37.40815501608069 127.10941561201501,37.40815501608069 127.10800180940232,37.409261689815324")
    val link5 = Link("127.10800180940232,37.409261689815324 127.10586801885873,37.41106574069227 127.10586801885873,37.41106574069227 127.10530619389702,37.41176432764656 127.10530619389702,37.41176432764656 127.10496133036295,37.41226631839657 127.10467154550763,37.412885864702055")
    val link6 = Link("127.10467154550763,37.412885864702055 127.1043930513888,37.41350549573973 127.10412823714485,37.41487312014614 127.10402123491342,37.4162689718941 127.10402123491342,37.4162689718941 127.10391476492995,37.41761977361653")
    val link7 = Link("127.10391476492995,37.41761977361653 127.10369500429674,37.41899674820238 127.10316786225393,37.42056962636052 127.10283391724735,37.42109872485528 127.10253547087721,37.42149293108373 127.10158610388424,37.422467887966505 127.1009925232219,37.4229769860888 127.10049125128579,37.42332459074001 127.0994449077099,37.42390232062568 127.09861567977437,37.42427445049464 127.09786563258544,37.42463816805629 127.09786563258544,37.42463816805629 127.09125426848455,37.427597103752035 127.08443913314748,37.430545076466196 127.08340474457245,37.43105066949394 127.08296103841093,37.431299527366924 127.0812863280537,37.432421869700555 127.07997334146572,37.43352898245655 127.07895430303371,37.43462034969501 127.07827685229749,37.435498115650326 127.07731914065994,37.43711256563432 127.07698195160046,37.437884851136864 127.07698195160046,37.437884851136864 127.07651415242029,37.439169723537006 127.07630999211841,37.44015029151325 127.07613551589722,37.441473496425836 127.0761329688449,37.442599810096375 127.07635066309801,37.44419639953799 127.07665090100578,37.44551430253289 127.07704122110093,37.44685994002718 127.07704122110093,37.44685994002718 127.07752162864466,37.448233311179926 127.07752162864466,37.448233311179926 127.07801136376783,37.44976894478248 127.07823740751661,37.45068979507754 127.07831676149051,37.45159147960933 127.07822416401613,37.452690057325576 127.07795073834372,37.45378722406533 127.07776382871975,37.45428135149064 127.07739398625102,37.45494525294077")
    val link8 = Link("127.07739398625102,37.45494525294077 127.07658569430704,37.45633559051355 127.07567265847591,37.45796839025748 127.07567265847591,37.45796839025748 127.07525679301828,37.45869499892441")
    val link9 = Link("127.07525679301828,37.45869499892441 127.07462162154415,37.45978932519272 127.07397779527238,37.46066732458447 127.07339380286267,37.46127547030344 127.07339380286267,37.46127547030344 127.06925937139289,37.46561313584547 127.06925937139289,37.46561313584547 127.06393626457235,37.470950429613715 127.06100521973869,37.47390067611472 127.06100521973869,37.47390067611472 127.06094779521298,37.473972304637975")
    val link10 = Link("127.06094779521298,37.473972304637975 127.06089070877445,37.47401690398734")
    val link11 = Link("127.06089070877445,37.47401690398734 127.0598266313779,37.47502664083665 127.05953033801595,37.475213505630684 127.05953033801595,37.475213505630684 127.05863692868748,37.47613448362907 127.0569884228985,37.47776126809717 127.0569884228985,37.47776126809717 127.05622066926773,37.47857510270454 127.05622066926773,37.47857510270454 127.05553339714449,37.47928144829859 127.05553339714449,37.47928144829859 127.0539531558271,37.480863681478205 127.05376931269494,37.4810964847559 127.05376931269494,37.4810964847559 127.05368812818716,37.481258025253936 127.05343326682701,37.48174255578202 127.05343326682701,37.48174255578202 127.0533290147306,37.48193995357134 127.05320169580092,37.48217320878573 127.05320169580092,37.48217320878573 127.05262355275269,37.48318677126068 127.05262355275269,37.48318677126068 127.05187124855013,37.48455935668738 127.05187124855013,37.48455935668738 127.05131488362017,37.485636161025994 127.05131488362017,37.485636161025994 127.05088629285737,37.48644367145912 127.05088629285737,37.48644367145912 127.05086311011814,37.48648853814356 127.05086311011814,37.48648853814356 127.05063128117425,37.48693720469839 127.05063128117425,37.48693720469839 127.05046956942347,37.48720622263739 127.05046956942347,37.48720622263739 127.05036541573267,37.48739460775215 127.05036541573267,37.48739460775215 127.05009886249229,37.48790606811917 127.05009886249229,37.48790606811917 127.04983264791164,37.488390498799696 127.04983264791164,37.488390498799696 127.04960035012867,37.488875201673075 127.04960035012867,37.488875201673075 127.04951914792504,37.489036738856036 127.04951914792504,37.489036738856036 127.04944616961356,37.48944162780281 127.04910970520181,37.490114713577725 127.04910970520181,37.490114713577725 127.04908640600948,37.49016858951472 127.047906221975,37.49227656964245 127.047906221975,37.49227656964245 127.04752472991458,37.49293126639156 127.0471354720139,37.493306571425585 127.0471354720139,37.493306571425585 127.04699566164054,37.49362982425547 127.04699566164054,37.49362982425547 127.04670587481638,37.49418614160479 127.04670587481638,37.49418614160479 127.04636844727708,37.49493129556306 127.04636844727708,37.49493129556306 127.04606642604023,37.49555959695238 127.04606642604023,37.49555959695238 127.04579889638339,37.49614312324351 127.04579889638339,37.49614312324351 127.04551890782734,37.49681665384523 127.04551890782734,37.49681665384523 127.04499685561278,37.497848649610916 127.04499685561278,37.497848649610916 127.04468304336643,37.49851289395524 127.04468304336643,37.49851289395524 127.0443571134016,37.49924011326357 127.0443571134016,37.49924011326357 127.04417147184903,37.49960804433268 127.04417147184903,37.49960804433268 127.0437760725837,37.50046084755777 127.0437760725837,37.50046084755777 127.04335735720288,37.50136752381341 127.04335735720288,37.50136752381341 127.04313651447498,37.5018342841156 127.04313651447498,37.5018342841156 127.04311320719209,37.50188815865871 127.04311320719209,37.50188815865871 127.04297416777514,37.50214833842905 127.04297416777514,37.50214833842905 127.04284540101163,37.50248969625816 127.04284540101163,37.50248969625816 127.04275240004424,37.50268717487462 127.04275240004424,37.50268717487462 127.04204356781655,37.50416817002656 127.04204356781655,37.50416817002656 127.04154357236392,37.50523636977939 127.04154357236392,37.50523636977939 127.04135778640185,37.50561330527409 127.04116172632004,37.50590906210033 127.0411503017813,37.50591797991275 127.04092077307014,37.50617742243572 127.04092077307014,37.50617742243572 127.04016455130564,37.50693717653616 127.04016455130564,37.50693717653616 127.0398663513018,37.5072591327223 127.0398663513018,37.5072591327223 127.03936203676467,37.507777644044424 127.03936203676467,37.507777644044424 127.03886856280103,37.508332283514406 127.03879978061185,37.50840380817341 127.03879978061185,37.50840380817341 127.03847941167676,37.50868953813633 127.03847941167676,37.50868953813633 127.03815857786697,37.50901130558804 127.03815857786697,37.50901130558804 127.03751690195,37.50965483770997 127.03751690195,37.50965483770997 127.03674848985855,37.51047754354117 127.03674848985855,37.51047754354117 127.036231431682,37.51110406350319 127.03578106674124,37.51182123091162 127.03578106674124,37.51182123091162 127.0355123532728,37.51248581669348 127.0355123532728,37.51248581669348 127.03540140042814,37.51319674291309 127.03540140042814,37.51319674291309 127.03538939429964,37.513250708069954 127.03538939429964,37.513250708069954 127.03536057353415,37.514611063243244 127.03536057353415,37.514611063243244 127.03537275776858,37.51542211061587")
    val link12 = Link("127.03537275776858,37.51542211061587 127.03618411710835,37.51566300805166 127.03618411710835,37.51566300805166 127.03634188847872,37.51570934804714 127.03634188847872,37.51570934804714 127.03660099373036,37.51579255654835 127.03660099373036,37.51579255654835 127.03714182760564,37.51595915628162 127.03714182760564,37.51595915628162 127.0382012278833,37.51626513542339 127.0382012278833,37.51626513542339 127.0390124902741,37.51651502323822 127.0390124902741,37.51651502323822 127.03978959447977,37.516782648872365 127.03978959447977,37.516782648872365 127.04044309107441,37.51698619153482 127.04044309107441,37.51698619153482 127.04126579531297,37.51722714634913")
    val link13 = Link("127.04126579531297,37.51722714634913 127.0412891089264,37.51717327239391")
    val links = Seq(link1, link2, link3, link4, link5, link6, link7,link8,link9,link10,link11,link12,link13)
    val sections = Section(true, links)

    val startTimeMillis = System.currentTimeMillis()
    for( a <- 1 to 10){
      makeCarPath(true, Some(Array(sections)))
    }
//    val result = makeCarPath(true, Some(Array(sections)))

    val endTimeMillis = System.currentTimeMillis()
    val durationSeconds = (endTimeMillis - startTimeMillis)

    println(durationSeconds/10f)



//    println(result)
  }


  def makeCarPath(path: Boolean, sections: Option[Array[Section]]): Option[String] = {
    (path, sections) match {
      case (true, Some(sections)) => {
        val p = sections.flatMap(section => {
          section.link.flatMap(l => l.points
            .split("\\ ")
            .map(xy => xy.split(",") match {
              case Array(x, y) => s"$y,$x"
//              case Array(x, y) => f"${y.toDouble}%.7f,${x.toDouble}%.7f"
              case _ => ""
            }))
        }).mkString(",")
        Some(p)
      }
      case _ => None
    }
  }
}

case class Section(success: Boolean,
                   link: Seq[Link])

case class Link(points: String)